o: ActiveSupport::Cache::Entry:@valueI" package org.camel.netty;

import org.apache.camel.*;
import org.apache.camel.builder.RouteBuilder;
import org.apache.camel.component.quickfixj.QuickfixjEndpoint;
import org.apache.camel.component.quickfixj.QuickfixjEventCategory;
import org.apache.camel.impl.DefaultCamelContext;
import org.openjdk.jmh.annotations.*;
import quickfix.Session;
import quickfix.SessionID;
import quickfix.SessionStateListener;

import java.util.concurrent.CountDownLatch;
import java.util.concurrent.TimeUnit;

/**
 * Created by dsemenov
 * Date: 10/23/15.
 */
@State(Scope.Thread)
@OutputTimeUnit(TimeUnit.SECONDS)
public class FixEngineMicroBenchmark {
  @State(Scope.Thread)
  public static class SleepyState {
    public CamelContext context;
    public ProducerTemplate producerTemplate;
    public ConsumerTemplate consumerTemplate;

    @Setup
    public void setup() throws Exception {
      CamelContext camelContext = new DefaultCamelContext();

      camelContext.start();
      producerTemplate = camelContext.createProducerTemplate();
      consumerTemplate = camelContext.createConsumerTemplate();
      camelContext
              .addRoutes(
                      new RouteBuilder() {
                        @Override
                        public void configure() throws Exception {
                          from("direct:start")
                                  .to("netty:tcp://localhost:5051?textline=true&sync=false");

                          from("netty:tcp://localhost:5051?textline=true&sync=false")
                                  //.delay(100)
                                  .validate(body().isInstanceOf(String.class))
                        }
                      }
              );

      context = camelContext;
    }
  }

  @Benchmark
  public void measure_netty_throughput(SleepyState s) {
    s.producerTemplate.sendBody("direct:start", "Hello Daemon");
    //Object o = s.consumerTemplate.receiveBody("direct:result");
  }

}:ET:@created_atf1449202444.0506473:@expires_in0